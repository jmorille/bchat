<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="redsms-conversations">

    <style>
        :host {
            display: block;
        }

        .addButton {
            background-color: red;

        }

        .conversationLine {
            height: 60px;
        }

        .avatar {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            background: #ccc;
        }

        paper-fab {
            position: fixed;
            right: 16px;
            bottom: 16px;
            z-index: 200;
        }

        .iron-selected {
            background-color: red;
        }
    </style>

    <template>
        <more-route context name="root"></more-route>
        <h1>Conv</h1>
        <bchat-layout>
            <button is="paper-button" on-tap="loadDatas">Load</button>
            <paper-fab icon="add" class="addButton" on-tap="addConversation"></paper-fab>
            <template id="msgList" is="dom-repeat" items="{{multiSelect}}">
                <span>{{item}}</span>
            </template>
            
            <iron-selector multi attr-for-selected="thread-id" selected-values="{{multiSelect}}">
                <template id="msgList" is="dom-repeat" items="{{conversations}}">
                    <section class="conversationLine" on-tap="_onForumTapped" thread-id$="[[item.id]]">
                        <iron-image class="avatar"
                                    sizing="contain"
                                    preload fade
                                    src="http://lorempixel.com/40/40/"></iron-image>
                        <span>{{item.displayName}}</span>
                        <span>{{item.phoneNumber}}</span>
                        -- <span>{{item.id}}</span> -- <span>{{item.selected}}</span>
                    </section>
                </template>
            </iron-selector>
        </bchat-layout>

        <more-route id="threadRoute" name="thread"></more-route>
        <redsms-db id="db" on-conversations-creating="loadDatas"></redsms-db>
    </template>
</dom-module>


<script>
    Polymer({
        is: 'redsms-conversations',

        properties: {
            conversations: {
                type: Array,
                notify: true,
                value: []
            },
            multiSelect: {
                type: Array,
                notify: true,
                value: []
            }
        },
        ready: function () {
            this.loadDatas();
        },
        loadDatas: function () {
            var that = this;
            this.$.db.getAllConversation(function (result) {
                that.conversations = result;
            });
        },
        addConversation: function (event, data) {
            MoreRouting.navigateTo('addConversation');
            event.preventDefault();
        },
        contactPickSuccess: function (contact) {
            console.log('The following contact has been selected:' + JSON.stringify(contact));
            console.log('Contact photo : ', contact.photos);
            this.push('conversations', contact);
        },
        openConversation: function (e, data) {
            console.log('Open conversation : ', data);
        },
        _onForumTapped: function (event) {
            var threadId = event.currentTarget.getAttribute('thread-id');
            // One way to navigate to a route is to call the `navigateTo` helper on
            // a `more-route` element that references it:
            console.log('Request navigateTo', threadId);
            this.$.threadRoute.navigateTo({threadId: threadId});
            event.stopPropagation();
            // Another way is by calling `MoreRouting.navigateTo` with the name or
            // path of the route and its params. You can see an example of this in
            // `polyfora-forum.html`.
        },


    });
</script>