<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="redsms-conversation-add">

    <style>
        :host {
            display: block;
        }
    </style>

    <template>
        <more-route context name="addConversation"></more-route>

        <bchat-layout page-tile="Add Conversation" route-back="root">
            <section layout vertical>

                <button is="paper-button" on-tap="_addConversation">Save</button>
                <button is="paper-button" on-tap="_pickContact">Pick</button>


                <paper-input value="{{displayName}}"  label="Nom" auto-validate required >
                </paper-input>

                <paper-input value="{{phoneNumber}}"  label="Phone Number" type="tel" auto-validate required >
                </paper-input>

                </input>


                <div>Phone : <span>{{phoneNumber}}</span></div>
                <div>displayName : <span>{{displayName}}</span></div>
            </section>

        </bchat-layout>

        <more-route id="threadRoute" name="thread"></more-route>
        <redsms-db id="db" on-conversations-creating="loadDatas"></redsms-db>
    </template>
    <redsms-db id="db"></redsms-db>
    <more-route id="threadRoute" name="thread"></more-route>
</dom-module>


<script>
    Polymer({
        is: 'redsms-conversation-add',

        ready: function () {
            this.db = this.$.db;
        },
        _addConversation: function () {
            var that = this;
            this.db.addConversation({
                phoneNumber: this.phoneNumber,
                displayName: this.displayName,
                avatar: this.avatar
            }, function (entityId) {
                that.$.threadRoute.navigateTo({threadId: entityId});
            });

        },
        _pickContact: function (event, data) {
            if (typeof window.cordova !== 'undefined') {
                // use contacts plugin
                console.log('Contact list', navigator.contacts);
                var contactSuccess = this.contactPickSuccess.bind(this);
                navigator.contacts.pickContact(contactSuccess, function (err) {
                    console.log('Error: ' + err);
                });
            }
        },
        contactPickSuccess: function (contact) {
            console.log('The following contact has been selected:' + JSON.stringify(contact));
            console.log('Contact photo : ', contact.photos);

            this.displayName = contact.displayName;
            this.phoneNumber = contact.phoneNumber[0];
            this.avatar = contact.photos[0];
        }

    });
</script>