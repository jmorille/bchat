<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="redsms-conversation-add">

    <style>
        :host {
            display: block;
        }
    </style>

    <template>
        <more-route context name="addConversation"></more-route>

        <bchat-layout page-tile="Add Conversation">
            <section layout vertical>

                <button is="paper-button" on-tap="_addConversation">Save</button>
                <button is="paper-button" on-tap="_pickContact">Pick</button>
                <paper-input  value="{{displayName}}" placeholder="Nom">
                </paper-input>


                <gold-phone-input country-code="33" phone-number-pattern="X-XX-XX-XX-XX"
                                  value="{{phoneNumber}}">
                </gold-phone-input>

                <div>Phone : <span>{{phoneNumber}}</span></div>
                <div>displayName : <span>{{displayName}}</span></div>
            </section>

        </bchat-layout>

        <more-route id="threadRoute" name="thread"></more-route>
        <redsms-db id="db"  on-conversations-creating="loadDatas"></redsms-db>
    </template>
    <redsms-db id="db" on-conversations-creating="loadDatas"></redsms-db>

</dom-module>


<script>
    Polymer({
        is: 'redsms-conversation-add',
        ready: function() {
          this.db = this.$.db;
        },
        _addConversation: function () {
            this.db.addConversation({
                phoneNumber: this.phoneNumber,
                displayName: this.displayName
            });

        },
        _pickContact: function (event, data) {
            if (typeof window.cordova !== 'undefined') {
                // use contacts plugin
                console.log('Contact list', navigator.contacts);
                var contactSuccess = this.contactPickSuccess.bind(this);
                navigator.contacts.pickContact(contactSuccess, function (err) {
                    console.log('Error: ' + err);
                });
            }
        },
        contactPickSuccess: function (contact) {
            console.log('The following contact has been selected:' + JSON.stringify(contact));
            console.log('Contact photo : ', contact.photos);

            this.displayName = contact.displayName;
            this.phoneNumber = contact.phoneNumber[0];
        },
        loadDatas: function () {
            console.log('--------- loadDatas');
        }

    });
</script>