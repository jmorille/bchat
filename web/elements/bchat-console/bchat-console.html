<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="bchat-console">

    <style>
        :host {
            display: block;
        }
    </style>

    <template>


        <template id="msgList" is="dom-repeat" items="{{messages}}">
            <div>
                <span>{{item.name}}</span>
                <span>: </span>
                <span>{{item.message}}</span>
                <span>( </span>
                <span>{{item.ordered}}</span>
                <span>)</span>
            </div>
            <button on-click="order">Order</button>
        </template>

        <p>

        <div>
            <input is="iron-input" bind-value="{{message}}" value="{{value::input}}">
            <button is="paper-icon-button" on-tap="sendMessage">Send</button>
        </div>
        <br>
        bind to <code>bind-value</code>: <span>[[message]]</span>
        <br>
        bind to <code>value::input</code>: <span>{{value}}</span>
        </p>

        <input is="iron-input" bind-value="{{first}}">
        <code>bind-value</code>: <span>{{first}}</span>


    </template>

</dom-module>

<script>
    Polymer({
        is: 'bchat-console',

        lastRecieveMsg: undefined,
        lastSendMsg: undefined,

        properties: {
            first: String,
            last: String,

            messages: {
                type: Array,
                notify: true,
                value: [
                    {name: 'Bob', message: 'Hello Alice', ordered: 0},
                    {name: 'Alice', message: 'Hi Bob!!!', ordered: 0}
                ]
            }
        },
        observers: [ 'usersAddedOrRemoved(messages.splices)' ],
        sendMessage: function (event, data) {
            var sendMsg = {name: 'me', message: this.message, ordered: 0};
            //   this.messages.push(sendMsg);
            this.push('messages', sendMsg);
            console.log('add msg', sendMsg);
            console.dir(this.messages);
            this.lastSendMsg = sendMsg;
            this.message = '';
        },
        order: function (e) {
            var model = e.model;
            model.set('item.ordered', model.item.ordered + 1);
        },
        usersAddedOrRemoved: function (changeRecord) {
            if (!changeRecord)
            {
                return;
            }
            changeRecord.indexSplices.forEach(function (s) {
                s.removed.forEach(function (user) {
                    console.log(user.name + ' was  removed');
                });
                console.log(s.addedCount + ' users  were added');
            }, this);
        }

    })
    ;
</script>
