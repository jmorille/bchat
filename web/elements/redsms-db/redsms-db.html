<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="redsms-db">

    <style>
        :host {
            display: block;
        }

    </style>

    <template>
    </template>

</dom-module>
<script src="../../bower_components/dexie/dist/latest/Dexie.js"></script>
<script>
    Polymer({ // http://www.html5rocks.com/en/tutorials/offline/storage/
        is: 'redsms-db',
        db: undefined,
        dbVersion: 1,
        tableConversation: 'conversations',
        created: function () {
            this._initDb();
            //this._openDb();
        },
        _initDb: function () {
            this.db = new Dexie("redsms-db");
            Dexie.Promise.on('error', function(err) {
                // Log to console or show en error indicator somewhere in your GUI...
                console.log("Uncaught error: " + err);
            });
            this.db.version(1).stores({
                conversations: '++id,displayName,phoneNumber',
                threads: '++id,conversationId,phoneNumber'
            }).upgrade (function (trans) {
              //  trans.conversations.add({displayName: 'Alice', phoneNumber: '0637474399', ordered: 0});
              //  trans.conversations.add({displayName: 'Bob', phoneNumber: '0766048649', ordered: 0});
            });
            this.db.open();
        },
        _openDb: function () {
            var db = this.db;
            db.transaction("rw", db.conversations , function() {
                db.conversations.add({displayName: 'Alice', phoneNumber: '0637474399', ordered: 0});
                db.conversations.add({displayName: 'Bob', phoneNumber: '0766048649', ordered: 0});
            });
        },

        addConversation: function (data, onsuccess, onerror) {
            var db = this.db;
            db.conversations.add(data);
        },
        getAllConversation: function (cb) {
            var db = this.db;
            db.conversations.toCollection().toArray(function (conversations) {
                cb(conversations);
            });
        }

    });
</script>
